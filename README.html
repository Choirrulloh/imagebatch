<html>
<head>
<title>Image Batch Processing</title>
<style type="text/css">
  dt { font-weight: bold; }
  /* Display nested dt and dd on the same line */
  dl dl dt { display: inline; float: left; clear: left; width: 3.2em; }
</style>
</head>

<body>

<h1>Image Batch Processing</h1>

<i><a href="http://shallowsky.com/mailme.html">...Akkana</a></i>

<p>
These scripts make it easy to upload large numbers of images
(from a scanner or digital camera, for example) and turn them
into web pages.  They run on Unix systems (other restrictions as noted)
though it might not be too hard to port them to other operating systems.
They're written in a motley collection of csh, perl and python.
You may freely use and modify these programs under the
<a href="http://www.gnu.org/">GNU Public License</a>.

<p>
<b>Download</b> the whole collection:
<a href="imagebatch-1.4.tar.gz">imagebatch-1.6.tar.gz</a>.
<br>
But that's from 2012. I've made some good changes in early 2015,
and you can browse the latest version on
<a href="https://github.com/akkana/imagebatch">GitHub: ImageBatch</a>.

<p>
<i>Warning!</i> These are not really set up as a nice usable package.
I'm under the impression that since there are a gazillion
packages to do this, nobody's actually going to want mine except
maybe as a learning tool or a starting point to write your own.
If you actually are trying to use these scripts and having trouble
figuring them out, please let me know.  I'll be happy to (1) answer
any questions or (2) write some better documentation.

<p>
<i>Requirements:</i> You should have ImageMagick (for scaling and thumbnail
drop shadows), libjpeg-progs (for jpegtran and jpegexiforient) and
jhead (for cleaning up unwanted EXIF like embedded thumbnails).
And Python, of course.

<p>
<a href="http://shallowsky.com/images/escalante/grosvenor">Here's a sample page</a>.

<h2>How to use</h2>
<p>
Here's a typical workflow for me, from photo upload to web page.

<ol>
<li>Upload images and view and catalog them with my
    <a href="http://shallowsky.com/blog/tags/metapho/">MetaPho</a> image
    tagger. Tag images in each subdirectory separately (I generally have
    one directory for each day of shooting), and use the special tag "web"
    for any images you'll want to include in the web page.
    Go ahead and tag the images with other tags as well.
<li>Create a new, empty directory "web" inside your trip directory.<br>
    This may be a symbolic link to a directory in your website.
    This step is optional; if there's no "./web" subdirectory,
    mkwebphotos will generate thumbnails and index.php files inside
    the current image directory, but will not scale or otherwise modify
    the images in the current directory.
<li>Run mkwebphotos.<br>
    This will copy all photos tagged "web" into the
    web subdirectory if there is one, making subdirectories as needed.
    If there is a web subdirectory, it will also run jhead -dt, rotate
    images with exiftran (so those vertical format images show up properly
    in browsers) and scale all the images to no larger than 800 pixels.
    (This is currently hardwired; edit the script to change that 800
    if you want larger or smaller images.)
    <br>
    Then it will make an index.php file in each directory that contains
    images or subdirectories.
<li>View the directory you've just made in a browser.<br>
    The index.html files will show tags as descriptions for each image
    or directory. This probably isn't what you want, so here's where
    you spend forever adding in real descriptions for the photos.
    And of course you'll want to change the page titles to something
    descriptive, and add some descriptive text.
    <br>
    If you have a hierarchy of directories, mkwebphotos will have chosen
    the first image in each subdirectory as the thumbnail for that directory
    on the parent page. You'll probably want to pick a different image,
    whatever is the most striking photo in each directory.
</ol>

<p>
If you don't use metapho so you don't have all those Tags files handy,
here's an older workflow, with more manual intervention:

<ol>
<li>After uploading images, I view and catalog them with my
    <a href="http://shallowsky.com/software/pho/">Pho image viewer</a>,
    (separate, not part of this package)
    marking the ones that I want to put on a web page.
<li>Copy those images to another directory somewhere (leaving the
    originals in place) and cd there.
<li>Use <i>rotateall</i> to rotate anything that needs it,
    e.g. <i>rotateall -right img004.jpg img007.jpg -left img011.jpg</i>
<li>Resize everything to a reasonable size for the web, e.g.
    <i>resizeall -size 600 *.jpg</i>
<li>Run <i>mkwebphotos</i>, which does the rest.
</ol>

<p>
The latest version of mkwebphotos creates a PHP file that handles the
thumbnail page and all the individual image pages. If you don't want to
use PHP, uncomment the tblimages line in <i>mkwebphotos</i> and it will
make an index.html page.

<h2>Descriptions of the individual scripts</h2>

<dl>

<dt>resizeall <i>(python)</i>
<dd>Rescale images to a smaller size (can also make thumbnails).
    It requires the imgsize script.
    <br>
    It's probably no longer necessary now that imagemagick can
    resize many images at once in place, at least if you learn the
    proper incantations:
    to do the same thing as resizeall -size 800 (which resizes all
    images so that their largest dimension is 800 pixels), you need
    <code>mogrify -quality 83 -scale 600^&gt;</code>
    <br>
    Note that in ImageMagick you have to give the <i>smaller</i>
    dimension if you're only giving one; I haven't found any syntax
    that lets you specify the larger one.

<dt>mkthumb <i>(symbolic link to resizeall)</i>
<dd>If resizeall is called as "mkthumb", it will automatically put itself
    in thumbnail mode, and (unless told otherwise) will generate drop
    shadows. Just make a link from resizeall to mkthumb.

<dt>rotateall <i>(csh)</i>
<dd>Rotate all the images, -left -cw -right -ccw -180 or -0.
    You can switch directions in midstream, e.g.
    <code>rotateall -cw foo.jpg bar.jpg -ccw baz.jpg</code>
    <br>
    If you have jpegtran installed, it will use that for lossless
    jpeg rotation.
    <br>
    It will remove all EXIF rotation information. To remove the EXIF
    rotation information without actually rotating anything, use
    <code>rotateall -0</code>

<dt>mkphplist <i>(python)</i>
<dd>Find images under the current directory and generate
    a file suitable for using <i>showpix.php</i>.
    This is faster than the Perl CGI, and more self contained,
    assuming you have PHP available. Called by mkwebphotos.

<dt>mkwebphotos <i>(python)</i>
<dd>Given a directory hierarchy containing images already sized,
    copy the images, make thumbnails and make a starter index.php.

<dt>thumbpage <i>(perl)</i>
<dd>Make a big HTML page of thumbnails suitable for printing from a browser.
    Useful if you want to keep a printed archive of your photo collection.

<dt>tblimages <i>(csh)</i>
<dd>Take a bunch of thumbnail images (assuming that full-sized
    images are in the same directory) and make a web page
    out of them. Lots of options:
    <dl>
    <dt>-t <dd>uses tables instead of fancy
        CSS lists (4 wide by default, but you can pass -1 through -9 to
    change that),
    <dt>-p <dd>makes it link to PHP pages instead of just the raw images,
    <dt>-c <dd>links to CGI pages instead of PHP or raw images,
    <dt>-r <dd>makes it recurse through subdirectories looking for images,
    <dt>-b <dd>puts a border on the thumbnails (if you're not using dropshadows)
    <dt>-n <dd>doesn't add HTML headers (in case you're making several
               snippets to paste together),
    <dt>-a <dd>adds annotation (see thumbpage to see how that works).
    </dl>

<dt>filestolower <i>(csh)</i>
<dd>csh: Convert filenames to lower case -- Windows image processing
    programs are forever converting my lower-case names to upper case.

<dt>imgsize <i>(Perl)</i>
<dd>Print the size of an image file.
    Based on code adapted from the excellent
    <a href="http://bloodyeck.com/wwwis/">wwwis</a>
    program,
    which is indispensable for setting width and height tags
    in html pages.

<dt>mkstatic <i>(sh)</i>
<dd>
Make a static.html page from index.html (e.g. to put on a CD or some
other medium that can't run PHP or CGI).

<dt>gallerypage-base.php <i>(PHP)</i>
<dd>
The PHP that does the work of generating the web pages.
Put this in a subdirectory of your web site called software, or
else change the path that <i>mkphplist </i> uses for its <i>require</i>.

<dt>css/gallery.css
<dt>css/gallerypic.css
<dt>css/gallery-ie.css
<dd>
CSS files that make the fancy list-based gallery pages work.
I'm indebted to <a href="http://www.brunildo.org/test/ImgThumbIBL3.html">this
brunildo example</a> and the related
<a href="http://archivist.incutio.com/viewlist/css-discuss/84544">discussion</a>
without which I might still be stuck on 4-column wide tables (like
on this <a href="http://shallowsky.com/images/stevcrk_1_20/">sample page</a>
for what tblimages creates with the -t option).

</dl>

<h2>Older files, no longer included</h2>

<dt>showpix-base.php <i>(PHP)</i>
<dd>PHP for showing individual images; unable to handle the thumbnail
    page and generally not as flexible as the newer gallerypage-base.php.
    The format of the image lists is the same, so if you have old
    image list showpix.php files that worked with showpix-base.php,
    you can probably just change the require line to use gallerypage-base.php
    instead.

<dl>
<dt>showpix.pl <i>(perl)</i>
<dd>CGI: Display full-sized images one by one,
    letting you step forward and backward,
    and allowing a short description for each image.
    (There seems to be no way to tell apache not to execute
    this .pl file, even with a .htaccess, so I've removed the .pl.)

<dt>mkpixlist <i>(perl)</i>
<dd>Find images under the current directory and generate
    a file suitable for using <i>showpix.cgi</i>.

</dl>

<hr>
<a href="../">Akkana's Software</a><br>
<a href="/linux/limaging.html">Linux Imaging</a><br>
<a href="/">Shallowsky Home</a>

</body>
</html>
